{
    "openapi": "3.0.1",
    "info": {
        "title": "Digital Balance Adjustment",
        "x-digitalapi-summary": "Digital Balance Adjustment upgrade of plan offering with redemption of value for an existing plan offering.",
        "description": "Digital Balance Adjustment upgrade of plan offering with redemption of value for an existing plan offering\n* [API Functional Mapping](https://jio.ril.com/sites/systems/design/_layouts/15/WopiFrame.aspx?sourcedoc=/sites/systems/design/Shared%20Documents/04.%20E2E%20Architecture%20and%20Solutions/02.%20Macro%20Design%20Documents/Functional%20Mappings/DigitalBalanceAdjustment.xls&action=default)\n### Note :\n* API Spec is aligned with Functional Mapping Version v0.4\n",
        "version": "1.0.0",
        "contact": {
            "name": "JioDigital U2CDevTeam",
            "email": "JioDigital.U2CDevTeam@ril.com"
        },
        "x-digitalapi-domain": "Digital",
        "x-digitalapi-subjectarea": "Billing",
        "x-digitalapi-application": "Manage Digital Balance",
        "x-digitalapi-functional-mapping-url": "https://jio.ril.com/sites/systems/design/_layouts/15/WopiFrame.aspx?sourcedoc=/sites/systems/design/Shared%20Documents/04.%20E2E%20Architecture%20and%20Solutions/02.%20Macro%20Design%20Documents/Functional%20Mappings/DigitalBalanceAdjustment.xls&action=default",
        "x-digitalapi-functional-mapping-version": "v0.4",
        "x-digitalapi-descriptor": {
            "$ref": "./digital-balance-adjustment-api-descriptor.yaml"
        }
    },
    "servers": [
        {
            "url": "https://digitalapi.gateway1.jio.com/digitalapi/digitalbalaceadjustment/v1"
        }
    ],
    "tags": [
        {
            "name": "Manage Digital Balance"
        }
    ],
    "paths": {
        "/digitalBalance/adjust": {
            "post": {
                "summary": "Adjust Digital Balance",
                "description": "Upgrade of plan offering with redemption of value for an existing plan offering",
                "operationId": "adjustBalance",
                "tags": [
                    "Digital Balance Adjustment"
                ],
                "parameters": [
                    {
                        "name": "jioroute",
                        "description": "Jio Route to enable routing of the transactions to zonal deployments of OCS (SAP-CC)",
                        "in": "header",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "jiodealerroute",
                        "description": "Logical entity to enable routing of the transactions to zonal deployments of Wallet Management System (ESTEL)",
                        "in": "header",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "channel-id",
                        "description": "Channel from which the request is originated",
                        "in": "header",
                        "required": true,
                        "example": "20",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/BalanceAdjustmentRequest"
                            },
                            "examples": {
                                "DigitalBalanceAdjustment": {
                                    "value": {
                                        "orderRefNo": "BA0000001S20",
                                        "transDateTime": "2020-12-18T22:01:06",
                                        "merchantCode": "Z217",
                                        "channelId": "92",
                                        "paymentDetails": {
                                            "modeOfPayment": "06",
                                            "totalAmountPayable": "521.67",
                                            "paymentGatewayTransId": "201218090502138323"
                                        },
                                        "lineItem": [
                                            {
                                                "planOfferingId": "1011268",
                                                "action": "01",
                                                "compositePrice": [
                                                    {
                                                        "id": "1160850",
                                                        "price": "660",
                                                        "priceType": "2",
                                                        "priceSubType": "10"
                                                    }
                                                ],
                                                "planOffering": [
                                                    {
                                                        "transRefNo": "10",
                                                        "planOfferingId": "1011262",
                                                        "planOfferingType": "1",
                                                        "category": "3",
                                                        "amount": "500",
                                                        "customerId": "5000029524",
                                                        "account": [
                                                            {
                                                                "accountId": "500000034855",
                                                                "accountType": "1",
                                                                "subscriptionType": "1",
                                                                "companyCode": "6000",
                                                                "circleId": "KL",
                                                                "product": [
                                                                    {
                                                                        "serviceId": "4957960111",
                                                                        "service": [
                                                                            {
                                                                                "serviceType": "Z0029",
                                                                                "chargingId": "914957960111"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "serviceId": "916186207771",
                                                                        "service": [
                                                                            {
                                                                                "serviceType": "Z0005",
                                                                                "chargingId": "48a2.5466.6574"
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "transRefNo": "20",
                                                        "planOfferingId": "1011265",
                                                        "planOfferingType": "4",
                                                        "category": "11",
                                                        "amount": "100",
                                                        "customerId": "5000029524",
                                                        "account": [
                                                            {
                                                                "accountId": "500000034855",
                                                                "accountType": "1",
                                                                "subscriptionType": "1",
                                                                "companyCode": "6000",
                                                                "circleId": "KL",
                                                                "product": [
                                                                    {
                                                                        "serviceId": "4957960111",
                                                                        "service": [
                                                                            {
                                                                                "serviceType": "Z0029",
                                                                                "chargingId": "914957960111"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "serviceId": "916186207771",
                                                                        "service": [
                                                                            {
                                                                                "serviceType": "Z0005",
                                                                                "chargingId": "48a2.5466.6574"
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "transRefNo": "30",
                                                        "planOfferingId": "1011266",
                                                        "planOfferingType": "32",
                                                        "category": "13",
                                                        "amount": "50",
                                                        "customerId": "5000029524",
                                                        "account": [
                                                            {
                                                                "accountId": "500000034855",
                                                                "accountType": "1",
                                                                "subscriptionType": "1",
                                                                "companyCode": "6000",
                                                                "circleId": "KL",
                                                                "product": [
                                                                    {
                                                                        "serviceId": "4957960111",
                                                                        "service": [
                                                                            {
                                                                                "serviceType": "Z0029",
                                                                                "chargingId": "914957960111"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "serviceId": "916186207771",
                                                                        "service": [
                                                                            {
                                                                                "serviceType": "Z0005",
                                                                                "chargingId": "48a2.5466.6574"
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "characteristic": [
                                                    {
                                                        "name": "STACKED_QUEUED",
                                                        "value": "2"
                                                    },
                                                    {
                                                        "name": "CALLBACK_REF_NOTIFY_URL",
                                                        "value": "jms:JioDigitalAPI.Digital.Adjustment.NotifyCallBack.DBAS.MYJIO.V01"
                                                    },
                                                    {
                                                        "name": "CUSTOMER_DETAILS",
                                                        "value": "nikhil lad"
                                                    },
                                                    {
                                                        "name": "MOBILE_NUMBER",
                                                        "value": "+918433980770"
                                                    },
                                                    {
                                                        "name": "EMAIL_ID",
                                                        "value": "nikhil.lad@ril.com"
                                                    },
                                                    {
                                                        "name": "MERCHANT_STATE",
                                                        "value": "KL"
                                                    },
                                                    {
                                                        "name": "PRODUCT_STATE",
                                                        "value": "KL"
                                                    }
                                                ]
                                            },
                                            {
                                                "planOfferingId": "1011316",
                                                "action": "03",
                                                "adjustmentDetail": {
                                                    "reasonCode": "RR05",
                                                    "rechargeRefNo": "TB00000027HW",
                                                    "amount": "138.33"
                                                },
                                                "planOffering": [
                                                    {
                                                        "transRefNo": "10",
                                                        "planOfferingId": "1011313",
                                                        "planOfferingType": "1",
                                                        "category": "3",
                                                        "amount": "100",
                                                        "customerId": "5000029524",
                                                        "account": [
                                                            {
                                                                "accountId": "500000034855",
                                                                "accountType": "1",
                                                                "subscriptionType": "1",
                                                                "companyCode": "6000",
                                                                "circleId": "KL",
                                                                "product": [
                                                                    {
                                                                        "serviceId": "4957960111",
                                                                        "service": [
                                                                            {
                                                                                "serviceType": "Z0029",
                                                                                "chargingId": "914957960111"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "serviceId": "916186207771",
                                                                        "service": [
                                                                            {
                                                                                "serviceType": "Z0005",
                                                                                "chargingId": "48a2.5466.6574"
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "transRefNo": "20",
                                                        "planOfferingId": "1011314",
                                                        "planOfferingType": "4",
                                                        "category": "11",
                                                        "amount": "20",
                                                        "customerId": "5000029524",
                                                        "account": [
                                                            {
                                                                "accountId": "500000034855",
                                                                "accountType": "1",
                                                                "subscriptionType": "1",
                                                                "companyCode": "6000",
                                                                "circleId": "KL",
                                                                "product": [
                                                                    {
                                                                        "serviceId": "4957960111",
                                                                        "service": [
                                                                            {
                                                                                "serviceType": "Z0029",
                                                                                "chargingId": "914957960111"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "serviceId": "916186207771",
                                                                        "service": [
                                                                            {
                                                                                "serviceType": "Z0005",
                                                                                "chargingId": "48a2.5466.6574"
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "transRefNo": "30",
                                                        "planOfferingId": "1011315",
                                                        "planOfferingType": "32",
                                                        "category": "13",
                                                        "amount": "30",
                                                        "customerId": "5000029524",
                                                        "account": [
                                                            {
                                                                "accountId": "500000034855",
                                                                "accountType": "1",
                                                                "subscriptionType": "1",
                                                                "companyCode": "6000",
                                                                "circleId": "KL",
                                                                "product": [
                                                                    {
                                                                        "serviceId": "4957960111",
                                                                        "service": [
                                                                            {
                                                                                "serviceType": "Z0029",
                                                                                "chargingId": "914957960111"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "serviceId": "916186207771",
                                                                        "service": [
                                                                            {
                                                                                "serviceType": "Z0005",
                                                                                "chargingId": "48a2.5466.6574"
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "characteristic": [
                                                    {
                                                        "name": "MERCHANT_STATE",
                                                        "value": "KL"
                                                    },
                                                    {
                                                        "name": "PRODUCT_STATE",
                                                        "value": "KL"
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Success",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/BalanceAdjustmentResponse"
                                },
                                "examples": {
                                    "DigitalBalanceAdjustment": {
                                        "value": {
                                            "orderRefNo": "BA0000001S20",
                                            "resultStatus": {
                                                "status": "SUCCESS"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                },
                                "example": {
                                    "resultStatus": {
                                        "status": "FAILED"
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "content": {
                            "application/json": {
                                "example": {
                                    "resultStatus": {
                                        "errorCode": "401",
                                        "errorMessage": "Unauthorized",
                                        "status": "FAILED"
                                    }
                                },
                                "schema": {
                                    "$ref": "#/components/schemas/UnauthorizedError"
                                }
                            }
                        },
                        "description": "Unauthorized"
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                },
                                "example": {
                                    "resultStatus": {
                                        "status": "FAILED"
                                    }
                                }
                            }
                        }
                    },
                    "default": {
                        "description": "Unexpected error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                },
                                "example": {
                                    "resultStatus": {
                                        "status": "FAILED"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "components": {
        "schemas": {
            "BalanceAdjustmentRequest": {
                "type": "object",
                "description": "Balance Adjustment Service Request Message",
                "required": [
                    "orderRefNo",
                    "transDateTime",
                    "merchantCode",
                    "channelId",
                    "paymentDetails",
                    "lineItem"
                ],
                "properties": {
                    "orderRefNo": {
                        "type": "string",
                        "description": "Digital Balance Adjustment Reference Number"
                    },
                    "transDateTime": {
                        "type": "string",
                        "description": "Timestamp of the transaction"
                    },
                    "action": {
                        "type": "string"
                    },
                    "merchantCode": {
                        "type": "string",
                        "description": "Merchant Code"
                    },
                    "agentCode": {
                        "type": "string",
                        "description": "Agent Code"
                    },
                    "channelId": {
                        "type": "string",
                        "description": "channel Id"
                    },
                    "paymentDetails": {
                        "$ref": "#/components/schemas/PaymentDetails"
                    },
                    "lineItem": {
                        "type": "array",
                        "description": "Balance Adjustment Line Items",
                        "items": {
                            "$ref": "#/components/schemas/LineItem"
                        }
                    }
                }
            },
            "BalanceAdjustmentResponse": {
                "type": "object",
                "description": "Balance Adjustment Service Response Message",
                "required": [
                    "orderRefNo"
                ],
                "properties": {
                    "orderRefNo": {
                        "type": "string",
                        "description": "Digital Balance Adjustment Reference Number"
                    },
                    "resultStatus": {
                        "$ref": "#/components/schemas/ResultStatus"
                    }
                }
            },
            "PaymentDetails": {
                "type": "object",
                "required": [
                    "modeOfPayment"
                ],
                "properties": {
                    "modeOfPayment": {
                        "type": "string",
                        "description": "Payment Mode\n"
                    },
                    "totalAmountPayable": {
                        "type": "string",
                        "description": "Total Amount to pay"
                    },
                    "paymentGatewayTransId": {
                        "type": "string",
                        "description": "Payment Gateway Transaction Id"
                    },
                    "paymentGatewayAlias": {
                        "type": "string",
                        "description": "Specify Payment Gateway Alias"
                    }
                }
            },
            "LineItem": {
                "type": "object",
                "description": "Balance Adjustment Line Item",
                "required": [
                    "planOffering"
                ],
                "properties": {
                    "planOfferingId": {
                        "type": "string",
                        "description": "Wrapper Plan Offering ID as selected for balance replenishment"
                    },
                    "action": {
                        "type": "string",
                        "description": "01 - ADD for the line item for replenishment, 03 - REMOVE for the line item for replenishment reversal"
                    },
                    "compositePrice": {
                        "type": "array",
                        "description": "Specifies the fetails of multipurpose Voucher spplicable for line item with action = 03 REMOVE",
                        "items": {
                            "$ref": "#/components/schemas/CompositePrice"
                        }
                    },
                    "adjustmentDetail": {
                        "$ref": "#/components/schemas/AdjustmentDetails"
                    },
                    "planOffering": {
                        "type": "array",
                        "description": "List of Plan Offering",
                        "items": {
                            "$ref": "#/components/schemas/PlanOffering"
                        }
                    },
                    "characteristic": {
                        "type": "array",
                        "description": "List of characteristic",
                        "items": {
                            "$ref": "#/components/schemas/Characteristic"
                        }
                    }
                }
            },
            "CompositePrice": {
                "type": "object",
                "description": "Composite Price",
                "required": [
                    "id",
                    "price",
                    "priceType",
                    "priceSubType"
                ],
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Composite Price Id"
                    },
                    "price": {
                        "type": "string",
                        "description": "Amount of multipurpose voucher"
                    },
                    "priceType": {
                        "type": "string",
                        "description": "Price type, e.g 2 - ONETIME"
                    },
                    "priceSubType": {
                        "type": "string",
                        "description": "Price Sub Type e.g. 16 - E-COUPON"
                    }
                }
            },
            "AdjustmentDetails": {
                "type": "object",
                "description": "Balance Adjustment details",
                "required": [
                    "reasonCode",
                    "rechargeRefNo",
                    "amount"
                ],
                "properties": {
                    "reasonCode": {
                        "type": "string",
                        "description": "Reason Code, specify constant RR05 - FTTX-Recharge Reversal"
                    },
                    "rechargeRefNo": {
                        "type": "string",
                        "description": "Specify the Recharge Reference Number of the transaction for which replenishment reversal is submitted."
                    },
                    "amount": {
                        "type": "string",
                        "description": "Total Amount for reversal for all the Plan Offering, applicable for line item with action 03 - REMOVE"
                    }
                }
            },
            "PlanOffering": {
                "type": "object",
                "description": "Plan offering details",
                "required": [
                    "planOfferingId",
                    "planOfferingType",
                    "category",
                    "customerId",
                    "account"
                ],
                "properties": {
                    "transRefNo": {
                        "type": "string",
                        "description": "Transaction reference number for a balance adjustment reference number."
                    },
                    "eWalletReservationRefNo": {
                        "type": "string",
                        "description": "EWallet Reservation Reference Id as provided by Wallet Management System upon reservation of Wallet"
                    },
                    "planOfferingId": {
                        "type": "string",
                        "description": "Plan Offering Id"
                    },
                    "planOfferingType": {
                        "type": "string",
                        "description": "Plan Offering Type <table style=\"width:100%\">\n  <tr><td>Code</td><td>Description</td></tr>\n  <tr><td>1</td><td>CONNECTIVITY RECHARGE</td></tr>\n  <tr><td>4</td><td>CONTENT/OTT RECHARGE</td></tr>\n  <tr><td>5</td><td>CONTENT/OTT STARTUP</td></tr>\n  <tr><td>7</td><td>CONNECTIVITY + CONTENT/OTT RECHARGE</td></tr>\n  <tr><td>8</td><td>CONNECTIVITY + CONTENT/OTT STARTUP</td></tr>\n  <tr><td>30</td><td>Content Flexi Top-Up</td></tr>\n  <tr><td>31</td><td>RENTAL STARTUP</td></tr>\n  <tr><td>32</td><td>RENTAL RECHARGE</td></tr>\n  </table>\n"
                    },
                    "category": {
                        "type": "string",
                        "description": "Plan offering Category\n  <table style=\"width:100%\">\n      <tr><td>Code</td><td>Description</td></tr>\n      <tr><td>3</td><td>FTTx Retail (For Combo)</td></tr>\n      <tr><td>4</td><td>FTTx Enterprise (For Combo)</td></tr>\n      <tr><td>5</td><td>Media Retail (For JioHomeTV)</td></tr>\n      <tr><td>6</td><td>Media Enterprise (For JioHomeTV)</td></tr>\n      <tr><td>11</td><td>OTT Retail (For RCITPL)</td></tr>\n      <tr><td>12</td><td>OTT Enterprise (For RCITPL)</td></tr>\n   </table>\n"
                    },
                    "amount": {
                        "type": "string"
                    },
                    "customerId": {
                        "type": "string",
                        "description": "Customer Id"
                    },
                    "account": {
                        "type": "array",
                        "description": "List of Accounts for the customer",
                        "items": {
                            "$ref": "#/components/schemas/Account"
                        }
                    }
                }
            },
            "Account": {
                "type": "object",
                "description": "Customer Connectivity Account details",
                "required": [
                    "accountId",
                    "accountType",
                    "subscriptionType",
                    "companyCode",
                    "circleId",
                    "product"
                ],
                "properties": {
                    "accountId": {
                        "type": "string",
                        "description": "Account Id"
                    },
                    "accountType": {
                        "type": "string",
                        "description": "Type of Account e.g. 1 CONNECTIVITY"
                    },
                    "subscriptionType": {
                        "type": "string",
                        "description": "Type of subscription and possible value 1 - PREPAID, 2 - POSTPAID"
                    },
                    "companyCode": {
                        "type": "string"
                    },
                    "circleId": {
                        "type": "string",
                        "description": "Customer Circle Id"
                    },
                    "product": {
                        "type": "array",
                        "description": "List of Products",
                        "items": {
                            "$ref": "#/components/schemas/Product"
                        }
                    }
                }
            },
            "Product": {
                "type": "object",
                "required": [
                    "serviceId"
                ],
                "properties": {
                    "serviceId": {
                        "type": "string",
                        "description": "Customer Service Id"
                    },
                    "service": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/Service"
                        }
                    }
                }
            },
            "Service": {
                "type": "object",
                "required": [
                    "serviceType"
                ],
                "properties": {
                    "serviceType": {
                        "type": "string",
                        "description": "Service Type e.g. Z0005 - FTTX, Z0029 - Jio Home Voice"
                    },
                    "chargingId": {
                        "type": "string",
                        "description": "Service charging Id"
                    }
                }
            },
            "Characteristic": {
                "type": "object",
                "required": [
                    "name",
                    "value"
                ],
                "properties": {
                    "name": {
                        "type": "string"
                    },
                    "value": {
                        "type": "string"
                    }
                }
            },
            "ErrorResponse": {
                "type": "object",
                "required": [
                    "resultStatus"
                ],
                "properties": {
                    "resultStatus": {
                        "$ref": "#/components/schemas/ResultStatus"
                    }
                }
            },
            "UnauthorizedError": {
                "type": "object",
                "description": "Authentication information is missing or invalid",
                "properties": {
                    "resultStatus": {
                        "$ref": "#/components/schemas/ResultStatus"
                    }
                }
            },
            "ResultStatus": {
                "type": "object",
                "description": "Service Response Result Status",
                "required": [
                    "status"
                ],
                "properties": {
                    "status": {
                        "enum": [
                            "SUCCESS",
                            "FAILED"
                        ],
                        "type": "string",
                        "description": "Status of Service SUCCESS/FAILED"
                    },
                    "exceptionType": {
                        "type": "string",
                        "description": "Exception type"
                    },
                    "errorCode": {
                        "type": "string",
                        "description": "Error Code"
                    },
                    "errorMessage": {
                        "type": "string",
                        "description": "Error Description"
                    },
                    "suggestedActions": {
                        "type": "array",
                        "description": "Suggested action(s) to resolve exception",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "securitySchemes": {
            "oauth": {
                "type": "oauth2",
                "description": "This API protected with OAuth2 with grant type client credential, provide client id (consumer key) and client secret (consumer secret) to generate access token",
                "flows": {
                    "clientCredentials": {
                        "tokenUrl": "https://digitalapi.gateway1.jio.com:443/digitalapi/platform/generate/oauth/accesstoken",
                        "scopes": {
                            "read": "Read",
                            "write": "Write"
                        }
                    }
                }
            }
        }
    },
    "security": [
        {
            "oauth": [
                "read",
                "write"
            ]
        }
    ]
}
